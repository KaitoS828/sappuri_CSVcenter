# 開発手順書 (Development Procedure)

本プロジェクト「サプリCSVセンター」の開発履歴と実装手順のまとめです。

## 1. プロジェクト初期設定
- **フレームワーク**: Next.js 14 (App Router), TypeScript, Tailwind CSS
- **環境構築**: Docker (`Dockerfile`, `docker-compose.yml`) によるコンテナ化
- **API連携**: Google Gemini APIを利用するための基盤作成 (`.env.local`)

## 2. 基本機能の実装 (MVP)
- **バックエンド (`app/api/extract`)**:
    - アップロードされたファイルをGemini APIへ送信。
    - システムプロンプトにより、非構造化データ（画像/PDF）からJSON形式で特定のフィールド（名前、住所など）を抽出するロジックを実装。
- **フロントエンド (`app/page.tsx`)**:
    - ドラッグ＆ドロップによるファイルアップロードUI。
    - 抽出データのテーブル表示。
    - 基本的なCSVダウンロード機能。

## 3. UI/UXの改善 ("HIVE-like")
- デザイン刷新: ダークモードやグラスモーフィズムを廃止し、視認性の高い「ライトベージュ」基調のクリーンなデザインへ変更。
- モデル最適化: `gemini-1.5-flash` を採用し、エラー時のフォールバック処理を追加して安定性を向上。

## 4. Pro機能の実装 (Step to 100%)
実務利用に耐える機能群を追加しました。
- **マルチページPDF対応**: System Promptを調整し、PDFの全ページを配列データとして一括解析するように変更。
- **Split View (比較編集)**: 編集モード時に、左側に「原本（画像/PDF）」、右側に「入力フォーム」を並べて表示するUIを実装。
- **Excel出力**: `xlsx` ライブラリを導入し、`.xlsx` 形式でのダウンロードに対応。
- **データ保護**: `localStorage` を利用したブラウザ内自動保存機能と、誤操作防止のバリデーション（必須項目チェック）を追加。

## 5. Ultimate機能の実装 (Step to 120%)
さらに生産性を高めるための機能を追加しました。
- **ショートカットキー**:
    - `Ctrl + Enter`: 編集の保存
    - `Esc`: キャンセル
- **データ自動整形 (Normalization)**:
    - 電話番号: ハイフンなし(`09012345678`) → あり(`090-1234-5678`) へ自動変換。
    - 日付: 表記ゆれを `YYYY/MM/DD` に統一。
- **処理状況の可視化**: 解析中の経過時間を0.1秒単位で表示するタイマーを実装。
- **ヘルプ機能**: 操作方法、ショートカット一覧、FAQを確認できるモーダルウィンドウを追加。

---
**保守・運用について**:
- APIキーの変更は `.env.local` を更新し、`docker-compose down -v && docker-compose up --build` で反映してください。
